<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Fengfan Liu" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Agent - Dive Into IC Design</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Agent";
        var mkdocs_page_input_path = "chapter_x_Module_Verification/test_bench_template/agent.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> Dive Into IC Design
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Chapter 1: Overview</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../chapter_1_Overview/what/">What is this book about?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../chapter_1_Overview/how/">How to read this book?</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Chapter x: Module Verification</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../what/">What work is required for Module Verification?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../test_plan_template/">Test Plan Template</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../write_test_plan/">Write test plan</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../review_test_plan/">Review test plan</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Test Bench Template</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../test_bench_template/">Test Plan Template</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Agent</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../env/">Env</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Chapter x: Top Verification</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../chapter_x_Top_Verification/what/">What work is required for TOP Verification?</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">Dive Into IC Design</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Chapter x: Module Verification</li>
          <li class="breadcrumb-item">Test Bench Template</li>
      <li class="breadcrumb-item active">Agent</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>xx_agent.sv</p>
<pre><code class="language-systemverilog">//=============================================================================
// Project  : xx
//
// File Name: xx_agent.sv
//
// Author   : Name   : Fengfan Liu
//            Company: my_company
//            Year   : 10/27/2022
//
// Version:   0.1
//
//=============================================================================
// Description: Agent for xx
//=============================================================================

`ifndef XX_AGENT_SV
`define XX_AGENT_SV

class xx_agent extends uvm_agent;

  `uvm_componet_utils(xx_agent)

  uvm_analysis_port #(xx_item) analysis_port;

  xx_config    cfg;
  xx_sequencer sqr;
  xx_driver    drv;
  xx_monitor   mon;

  local int m_is_active = -1;

  extern function new(string name, uvm_component parent);

  extern function void build_phase(uvm_phase phase);
  extern function void connect_phase(uvm_phase phase);
  extern task main_phase(uvm_phase phase);
  extern function uvm_active_passive_enum get_is_active();

endclass: xx_agent

function xx_agent::new(string name, uvm_component parent);
  super.new(name, parent);
  analysis_port = new(&quot;&quot;analysis_port&quot;, this);
endfunction: new

function void xx_agent::build_phase(uvm_phase phase);
  if (!uvm_config_db #(xx_config)::get(this, &quot;&quot;, &quot;config&quot;, cfg)) begin
    `uvm_fatal(get_type_name(), $psprintf(&quot;xx config not found&quot;));
  end
  mon = xx_monitor::type_id::create(&quot;mon&quot;, this);
  if (get_is_active() == UVM_ACTIVE) begin
    drv = xx_driver::type_id::create(&quot;drv&quot;, this);
    sqr = src_req_sequencer::type_id::create(&quot;sqr&quot;, this);
  end
endfunction: build_phase

function void xx_agent::connect_phase(uvm_phase phase);
  if (cfg.vif == null) begin
    `uvm_warning(get_type_name(), &quot;xx virtual interface is not set&quot;)
  end
  mon.vif = cfg.vif;
  mon.cfg = cfg;
  mon.analysis_port.connect(analysis_port);
  if (get_is_active() == UVM_ACTIVE) begin
    drv.seq_item_port.connect(sqr.seq_item_export);
    drv.vif = cfg.vif;
    drv.cfg = cfg;
  end
endfunction: connect_phase

task xx_agent::main_phase(uvm_phase phase);
  string kind = &quot;HARD&quot;;
  forever begin
    @(negedge cfg.vif.rst_n);
    mon.handle_reset(kind);
    if (drv != null) begin
      drv.handle_reset(kind);
    end
    if (sqr != null) begin
      sqr.handle_reset(phase, kind);
    end
    @(posedge cfg.vif.rst_n);
  end
endtask: main_phase

function uvm_active_passive_enum xx_agent::get_is_active();
  if (m_is_active == -1) begin
    if (uvm_config_db #(uvm_bitstream_t)::get(this, &quot;&quot;, &quot;is_active&quot;, m_is_active)) begin
      if (m_is_active != cfg.is_active) begin
        `uvm_fatal(get_type_name(), $psprintf(&quot;is_active field in config_db conflicts with config object&quot;));
      end else begin
        m_is_active = cfg.is_active;
      end
    end
  end
  return uvm_active_passive_enum'(m_is_active);
endfunction: get_is_active

`endif // XX_AGENT_SV
</code></pre>
<p>xx_config.sv</p>
<pre><code class="language-systemverilog">//=============================================================================
// Project  : xx
//
// File Name: xx_config.sv
//
// Author   : Name   : Fengfan Liu
//            Company: my_company
//            Year   : 10/27/2022
//
// Version:   0.1
//
//=============================================================================
// Description: Configuration for agent xx
//=============================================================================

`ifndef XX_CONFIG_SV
`define XX_CONFIG_SV

class xx_config extends uvm_object;

  `uvm_object_utils(xx_config)

  virtual xx_interface vif;

  uvm_active_passive_enum is_active = UVM_ACTIVE;

  bit coverage_enable;
  bit checks_enable;
  // when enable, constraint all gap == 0
  bit performance_check_enable;

  rand int sub_seq_numbs;
  rand int sub_seq_times;
  rand bit is_repeat[100];
  rand int xx_gap[100];
  rand int xx_vld_high;
  rand int timeout;

  extern function new(string name = &quot;xx_config&quot;);

  constraint xx_gap_cons {
    if (performance_check_enable) {
      foreach (xx_gap[i]) {
        xx_gap[i] == 0;
      }
    }
    else {
      foreach (xx_gap[i]) { 
        xx_gap[i] dist {0:/30, [5:5*2]:/30, [5*2:5*3]:/10, [5*3:5*5]:/10, [5*5:5*10]:/10, [5*10:5*20]:/9, [5*200:5*400]:/1};  
      }
    }
  }

  constraint xx_vld_high_cons {
    xx_vld_high == 1;
  }

  // all case should run total_req_num = sub_seq_times * sub_seq_numbs
  constraint req_num_cons {
    sub_seq_times dist {[100:200]:/20, [200:300]:/50, [300:400]:/30};
    sub_seq_numbs == 7;
  }


  constraint timeout_cons {
    timeout == 10000000;
  }

  // End of inlined include file

endclass : xx_config 


function xx_config::new(string name = &quot;xx_config&quot;);
  super.new(name);
endfunction : new


`endif // XX_CONFIG_SV
</code></pre>
<p>xx_coverage.sv</p>
<pre><code class="language-systemverilog">//=============================================================================
// Project  : xx
//
// File Name: xx_coverage.sv
//
// Author   : Name   : Fengfan Liu
//            Company: my_company
//            Year   : 10/27/2022
//
// Version:   0.1
//
//=============================================================================
// Description: Coverage for agent xx
//=============================================================================

`ifndef XX_COVERAGE_SV
  `define XX_COVERAGE_SV

  class xx_coverage extends uvm_subscriber #(xx_item);

    `uvm_component_utils(xx_coverage)

    xx_config cfg;
    xx_item   item;

    bit is_covered;

    covergroup cg_foo;
      option.per_instance = 1;

      cp_foo: coverpoint item.foo;
      cp_bar: coverpoint item.bar;

      foo: cross cp_foo, cp_bar;

    endgroup

    extern function new(string name, uvm_component parent);
    extern function void write(input xx_item t);
    extern function void build_phase(uvm_phase phase);
    extern function void report_phase(uvm_phase phase);

  endclass : xx_coverage 


  function xx_coverage::new(string name, uvm_component parent);
    super.new(name, parent);
    is_covered = 0;
    cg_foo = new();
  endfunction : new


  function void xx_coverage::write(input xx_item t);
    if (cfg.coverage_enable) begin
      item = t;
      cg_foo.sample();
      if (cg_foo.get_inst_coverage() &gt;= 100) begin
        is_covered = 1;
      end
    end

  endfunction : write


  function void xx_coverage::build_phase(uvm_phase phase);
    if (!uvm_config_db #(xx_config)::get(this, &quot;&quot;, &quot;config&quot;, cfg)) begin
      `uvm_error(get_type_name(), &quot;src_req config not found&quot;)
    end

  endfunction : build_phase


  function void xx_coverage::report_phase(uvm_phase phase);
    if (cfg.coverage_enable) begin
      `uvm_info(get_type_name(), $sformatf(&quot;Coverage score = %3.1f%%&quot;, cg_foo.get_inst_coverage()), UVM_MEDIUM)
    end else begin
      `uvm_info(get_type_name(), &quot;Coverage disabled for this agent&quot;, UVM_MEDIUM)
    end

  endfunction : report_phase


`endif // XX_COVERAGE_SV
</code></pre>
<p>xx_driver.sv</p>
<pre><code class="language-systemverilog">
</code></pre>
<p>xx_interface.sv</p>
<pre><code class="language-systemverilog">
</code></pre>
<p>xx_item.sv</p>
<pre><code class="language-systemverilog">
</code></pre>
<p>xx_monitor.sv</p>
<pre><code class="language-systemverilog">
</code></pre>
<p>xx_sequence_library.sv</p>
<pre><code class="language-systemverilog">
</code></pre>
<p>xx_sequencer.sv</p>
<pre><code class="language-systemverilog">
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../test_bench_template/" class="btn btn-neutral float-left" title="Test Plan Template"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../env/" class="btn btn-neutral float-right" title="Env">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../test_bench_template/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../env/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
